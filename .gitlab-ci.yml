stages:
  - build
  - lint
  - test

# BUILD STAGE
build-backend:
  stage: build
  image: gradle:7.5-jdk17
  script:
    - echo "Building backend..."
    - cd backend
    - ./gradlew clean build
  rules:
    - when: always
  allow_failure: false

# LINT STAGE
lint-backend:
  stage: lint
  image: gradle:7.5-jdk17
  script:
    - echo "Checking backend linter..."
    - cd backend
    - ./gradlew check
  rules:
    - when: always
  allow_failure: false

lint-frontend:
  stage: lint
  image: node:22
  script:
    - echo "Checking frontend linter..."
    - cd frontend
    - npm ci
    - npx eslint .
  rules:
    - when: always
  allow_failure: false

# TEST STAGE
test-backend:
  stage: test
  image: gradle:7.5-jdk17
  script:
    - echo "Running backend tests..."
    - cd backend
    - ./gradlew test
  rules:
    - when: always
  allow_failure: false

test-frontend:
  stage: test
  image: node:22
  script:
    - echo "Running frontend tests with Vitest..."
    - cd frontend
    - npm ci
    - npx vitest run --coverage
  rules:
    - when: always
  allow_failure: false