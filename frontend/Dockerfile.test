FROM node:22

WORKDIR /usr/src/app

# Copy package files and install dependencies
COPY package*.json ./
RUN npm install

# Copy application code
COPY . .

# Create a test script that waits for backend and runs tests
RUN echo '#!/bin/bash\n\
echo "Running integration tests against backend at $VITE_API_BASE_URL"\n\
npm run test:integration\n\
' > /usr/src/app/run-tests.sh \
&& chmod +x /usr/src/app/run-tests.sh

CMD ["/usr/src/app/run-tests.sh"]